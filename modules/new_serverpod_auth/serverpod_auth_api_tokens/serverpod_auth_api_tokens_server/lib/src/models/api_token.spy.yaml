class: ApiToken
serverOnly: true
table: serverpod_auth_api_token
fields:
  id: UuidValue?, defaultPersist=random

  ### The [AuthUser] this API token belongs to
  authUser: module:auth_user:AuthUser?, relation(onDelete=Cascade)

  ### The scopes this API token provides access to.
  ###
  ### These are not connected to the [authUser], and can for example represent a subset of their permissions.
  scopeNames: Set<String>

  ### The time when this API token was created.
  created: DateTime, default=now

  ### The time when this access token was last used.
  ###
  ### Operates only with minute resolution, to avoid excessive writes to the database.
  lastUsed: DateTime, default=now

  ### The time after which this token can not be used anymore.
  ###
  ### If `null`, the token can be used indefinitely.
  expiresAt: DateTime?

  ### The maximum duration this token can go unused.
  ###
  ### If set, and the token is used after [lastUsed] + [expireAfterUnusedFor], then it will be rejected.
  ###
  ### If `null`, the token is valid until [expiresAt].
  expireAfterUnusedFor: Duration?

  ### Hashed version of the API token.
  ###
  ### Per default a token uses 64 bytes of random data, and its hash is stored peppered and salted.
  apiTokenHash: ByteData

  ### The salt used for computing the [apiTokenHash].
  ###
  ### Per default uses 16 bytes of random data.
  apiTokenSalt: ByteData

  ### The kind of API token this represents.
  ###
  ### This does not impact the behavior of the token, but can be useful for debugging.
  ### For example this could be used to differentiate between anonymous accounts, personal access tokens, or service accounts.
  kind: String, default=""
