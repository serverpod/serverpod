### Encrypted phone ID storage.
###
### Stores the phone number encrypted so it can be retrieved when needed.
class: SmsPhoneIdCrypto
serverOnly: true
table: serverpod_auth_idp_sms_phone_id_crypto
fields:
  id: UuidValue?, defaultPersist=random_v7

  ### The [AuthUser] this phone belongs to
  authUser: module:auth:AuthUser?, relation(onDelete=Cascade)

  ### The hash of the phone number (for lookup).
  phoneHash: String

  ### The encrypted phone number.
  phoneEncrypted: ByteData

  ### The nonce used for encryption.
  nonce: ByteData

  ### The MAC tag for authenticated encryption.
  mac: ByteData

indexes:
  serverpod_auth_idp_sms_phone_id_crypto_auth_user_id:
    fields: authUserId
    unique: true
  serverpod_auth_idp_sms_phone_id_crypto_phone_hash:
    fields: phoneHash
    unique: true
